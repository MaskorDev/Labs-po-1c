
&НаКлиенте
Процедура Импорт(Команда)
	Описание = Новый ОписаниеОповещения("ОткрытьФайл", ЭтотОбъект, Новый Структура);
	НачатьПомещениеФайлаНаСервер(Описание);
КонецПроцедуры

&НаКлиенте
Процедура ОткрытьФайл(Файл, ДопПарам) Экспорт
	Попытка
		ОткрытьФайлНаСервере(Файл.СсылкаНаФайл.Файл.ПолноеИмя);
	Исключение
		Сообщить("Файл не был выбран");
	КонецПопытки;
КонецПроцедуры

&НаСервере
Процедура ОткрытьФайлНаСервере(Путь)
	ТабДок = Новый ТабличныйДокумент;
	Попытка
		ТабДок.Прочитать(Путь);
		Для Счетчик = 2 по ТабДок.ВысотаТаблицы Цикл
			Артикул = ТабДок.Область(Счетчик, 1).Текст;
			ЕдИзм = ТабДок.Область(Счетчик, 4).Текст;
			Тип = ТабДок.Область(Счетчик, 5).Текст;
			Дубликат = Справочники.Фурнитура.НайтиПоКоду(Артикул);
			Если не ЗначениеЗаполнено(Дубликат) тогда
				НоваяФурнитура = Справочники.Фурнитура.СоздатьЭлемент();
				НоваяФурнитура.Код = Артикул;
				НоваяФурнитура.Наименование = ТабДок.Область(Счетчик, 2).Текст;
				НоваяФурнитура.Количество = ТабДок.Область(Счетчик, 3).Текст;
				Если Справочники.ЕдиницаИзмерения.НайтиПоНаименованию(ЕдИзм, Истина) =
					Справочники.ЕдиницаИзмерения.ПустаяСсылка() тогда
					НоваяЕдИзм = Справочники.ЕдиницаИзмерения.СоздатьЭлемент();
					НоваяЕдИзм.Наименование = ЕдИзм;
					НоваяЕдИзм.Записать();
					Сообщить("Запись " + ЕдИзм + " добавлен в справочник ЕдиницаИзмерения");
				КонецЕсли;
				НоваяФурнитура.ЕдиницаИзмерения = Справочники.ЕдиницаИзмерения.НайтиПоНаименованию(ЕдИзм, Истина);
				
				Если Справочники.ТипФурнитуры.НайтиПоНаименованию(Тип, Истина) =
					Справочники.ТипФурнитуры.ПустаяСсылка() тогда
					НовыйТип = Справочники.ТипФурнитуры.СоздатьЭлемент();
					НовыйТип.Наименование = Тип;
					НовыйТип.Записать();
					Сообщить("Запись " + Тип + " добавлен в справочник ТипФурнитуры");
				КонецЕсли;
				НоваяФурнитура.ТипФурнитуры = Справочники.ТипФурнитуры.НайтиПоНаименованию(Тип, Истина);
				
				НоваяФурнитура.Цена = ТабДок.Область(Счетчик, 6).Текст;
				Попытка
					Картинка = Новый Картинка("C:\Users\sourc\Desktop\1C\Ресурсы\Ресурсы\data\Изображения\Фурнитура\" + Артикул + ".jpg");
					Если не ЗначениеЗаполнено(Картинка) тогда
						Картинка = Новый Картинка("C:\Users\sourc\Desktop\1C\Ресурсы\Ресурсы\data\Изображения\Фурнитура\" + Артикул + ".png");
					КонецЕсли;
				Исключение
					Сообщить(ОписаниеОшибки());	
				КонецПопытки;
				Изображение = ПоместитьВоВременноеХранилище(Картинка);
				НоваяФурнитура.Хранилище = Новый ХранилищеЗначения(ПолучитьИзВременногоХранилища(Изображение));
				НоваяФурнитура.Записать();
				Сообщить("Запись " + Артикул + " добавлен в справочник Фурнитура");	
			КонецЕсли;
		КонецЦикла
	Исключение
		Сообщить(ОписаниеОшибки());
	КонецПопытки;
КонецПроцедуры


