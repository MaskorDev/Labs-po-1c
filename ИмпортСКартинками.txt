
&НаКлиенте
Процедура Импорт(Команда)
	Описание = Новый ОписаниеОповещения("ОткрытьФайл", ЭтотОбъект, Новый Структура);
	НачатьПомещениеФайлаНаСервер(Описание);
КонецПроцедуры

// Первые две процедуры должны быть на клиенте
&НаКлиенте
Процедура ОткрытьФайл(Файл, ДопПарам) Экспорт
	Попытка
		ОткрытьФайлНаСервере(Файл.СсылкаНаФайл.Файл.ПолноеИмя);
	Исключение
		Сообщить("Файл не был выбран");
	КонецПопытки;
КонецПроцедуры

&НаСервере
Процедура ОткрытьФайлНаСервере(Путь)
	ТабДок = Новый ТабличныйДокумент;
	Попытка
		ТабДок.Прочитать(Путь);
		Для Счетчик = 3 по 13 Цикл
			Наименование = ТабДок.Область(Счетчик, 3).Текст;
			Подразделение = ТабДок.Область(Счетчик, 1).Текст;
			Должность = ТабДок.Область(Счетчик, 2).Текст;
			ДатаРождения = ТабДок.Область(Счетчик, 4).Текст;
			Дубликат = Справочники.Сотрудники.НайтиПоНаименованию(Наименование, Истина);
			Если не ЗначениеЗаполнено(Дубликат) тогда
				НовыйСотрудник = Справочники.Сотрудники.СоздатьЭлемент();
								
				// Добавление нового элемента в справочник
				Если Справочники.Подразделения.НайтиПоНаименованию(Подразделение, Истина) =
				Справочники.Подразделения.ПустаяСсылка() тогда
					НовоеПодразделение = Справочники.Подразделения.СоздатьЭлемент();
					НовоеПодразделение.Наименование = Подразделение;
					НовоеПодразделение.Записать();
					Сообщить("Добавлена новая запись: " + Подразделение + " в справочник Подразделения");
				КонецЕсли;
				
				// Выбор ссылки из справочника
				НовыйСотрудник.Подразделение = Справочники.Подразделения.НайтиПоНаименованию(Подразделение, Истина);
				
				Если Справочники.Должности.НайтиПоНаименованию(Должность, Истина) =
				Справочники.Должности.ПустаяСсылка() тогда
					НоваяДолжность = Справочники.Должности.СоздатьЭлемент();
					НоваяДолжность.Наименование = Должность;
					НоваяДолжность.Записать();
					Сообщить("Добавлена новая запись: " + Должность + " в справочник Должности");
				КонецЕсли;
				НовыйСотрудник.Должность = Справочники.Должности.НайтиПоНаименованию(Должность, Истина);
				
				НовыйСотрудник.Наименование = Наименование;
				
				// Написание даты с Excel
				НовыйСотрудник.ДатаРождения = Дата("18991230") + Число(ДатаРождения * 24 * 3600);
				НовыйСотрудник.Записать();
				Сообщить("Добавлена новая запись: " + Наименование + " в справочник Сотрудники");
			КонецЕсли;
		КонецЦикла;	
	Исключение
		Сообщить(ОписаниеОшибки());
	КонецПопытки	
КонецПроцедуры


