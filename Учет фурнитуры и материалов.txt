
&НаКлиенте
Процедура ВыберитеКатегориюКачестваПриИзменении(Элемент)
	Список.Отбор.Элементы.Очистить();
	ЭлементОтбора = Список.Отбор.Элементы.Добавить(Тип("ЭлементОтбораКомпоновкиДанных"));
	ЭлементОтбора.ЛевоеЗначение = Новый ПолеКомпоновкиДанных("КатегорияКачества");
	ЭлементОтбора.ВидСравнения = ВидСравненияКомпоновкиДанных.Равно;
	ЭлементОтбора.ПравоеЗначение = ВыберитеКатегориюКачества;
	ПолучитьИтог();
КонецПроцедуры

&НаКлиенте
Процедура ПоказатьВсе(Команда)
	Список.Отбор.Элементы.Очистить();
	ВыберитеКатегориюКачества = "";
	ПолучитьИтог();
КонецПроцедуры

&НаСервере
Процедура ПолучитьИтог()
	Если не ВыберитеКатегориюКачества.Пустая() тогда	
		Запрос = Новый Запрос("ВЫБРАТЬ
		|	СУММА(Фурнитура.Количество) КАК Количество,
		|	КОЛИЧЕСТВО(Фурнитура.Код) КАК ВсеМатериалы,
		|	СУММА(Фурнитура.ЗакупочнаяСтоимость) КАК ЗакупочнаяСтоимость
		|ИЗ
		|	Справочник.Фурнитура КАК Фурнитура
		|ГДЕ
		|	Фурнитура.КатегорияКачества = &КатегорияКачества");
		Запрос.УстановитьПараметр("КатегорияКачества", ВыберитеКатегориюКачества);
		Результат = Запрос.Выполнить().Выгрузить();
		ВсегоМатериалов = Результат[0].ВсеМатериалы;
		ИтогоЗакупочнойСтоимости = Результат[0].ЗакупочнаяСтоимость;
		КоличествоМатериалов = Результат[0].Количество;
	Иначе
		Запрос = Новый Запрос("ВЫБРАТЬ
		|	СУММА(Фурнитура.Количество) КАК Количество,
		|	КОЛИЧЕСТВО(Фурнитура.Код) КАК ВсегоМатериалов,
		|	СУММА(Фурнитура.ЗакупочнаяСтоимость) КАК ЗакупочнаяСтоимость
		|ИЗ
		|	Справочник.Фурнитура КАК Фурнитура");
		Результат = Запрос.Выполнить().Выгрузить();
		ВсегоМатериалов = Результат[0].ВсегоМатериалов;
		ИтогоЗакупочнойСтоимости = Результат[0].ЗакупочнаяСтоимость;
		КоличествоМатериалов = Результат[0].Количество;
	КонецЕсли;
КонецПроцедуры

&НаКлиенте
Процедура ПриОткрытии(Отказ)
	ПолучитьИтог();
КонецПроцедуры
