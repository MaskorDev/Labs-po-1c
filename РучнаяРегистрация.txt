// В справочнике, где необходимо создавать пользователей
&НаСервере
Процедура ПередЗаписьюНаСервере(Отказ, ТекущийОбъект, ПараметрыЗаписи)
	Запрос = Новый Запрос("ВЫБРАТЬ
	|	Пользователи.УникальныйИдентификатор КАК УникальныйИдентификатор,
	|	Пользователи.Логин КАК Логин
	|ИЗ
	|	Справочник.Пользователи КАК Пользователи
	|ГДЕ
	|	Пользователи.Логин = &Логин");
	
	Запрос.УстановитьПараметр("Логин", Объект.Логин); 
	Результат = Запрос.Выполнить().Выбрать();
	Если Результат.Следующий() тогда
		Если Результат.Количество() = 0 ИЛИ ТекущийОбъект.УникальныйИдентификатор = Объект.УникальныйИдентификатор тогда
			СсылкаПользователь = ПользователиИнформационнойБазы.НайтиПоУникальномуИдентификатору(ТекущийОбъект.УникальныйИдентификатор);
			Если СсылкаПользователь = Неопределено тогда
				НовыйПользователь = ПользователиИнформационнойБазы.СоздатьПользователя();
				НовыйПользователь.ПолноеИмя = Объект.Наименование;
				НовыйПользователь.Имя = Объект.Логин;
				Если Объект.Роль = Перечисления.Роли.Администратор тогда
					НовыйПользователь.Роли.Добавить(Метаданные.Роли.Администратор);
				ИначеЕсли Объект.Роль = Перечисления.Роли.Менеджер тогда
					НовыйПользователь.Роли.Добавить(Метаданные.Роли.Менеджер);
				ИначеЕсли Объект.Роль = Перечисления.Роли.Мастер тогда
					НовыйПользователь.Роли.Добавить(Метаданные.Роли.Мастер);
				КонецЕсли;
				НовыйПользователь.ПоказыватьВСпискеВыбора = Ложь;
				НовыйПользователь.Записать();
			Иначе
				НовыйПользователь = ПользователиИнформационнойБазы.СоздатьПользователя();
				НовыйПользователь.ПолноеИмя = Объект.Наименование;
				НовыйПользователь.Имя = Объект.Логин;
				Если Объект.Роль = Перечисления.Роли.Администратор тогда
					НовыйПользователь.Роли.Добавить(Метаданные.Роли.Администратор);
				ИначеЕсли Объект.Роль = Перечисления.Роли.Менеджер тогда
					НовыйПользователь.Роли.Добавить(Метаданные.Роли.Менеджер);
				ИначеЕсли Объект.Роль = Перечисления.Роли.Мастер тогда
					НовыйПользователь.Роли.Добавить(Метаданные.Роли.Мастер);
				КонецЕсли;
				НовыйПользователь.Записать();
			КонецЕсли;
		Иначе
			Сообщить("Пользователь с таким логином уже существует");
			Отказ = Истина;
		КонецЕсли;
	Иначе
		НовыйПользователь = ПользователиИнформационнойБазы.СоздатьПользователя();
		НовыйПользователь.ПолноеИмя = Объект.Наименование;
		НовыйПользователь.Имя = Объект.Логин;
		Если Объект.Роль = Перечисления.Роли.Администратор тогда
			НовыйПользователь.Роли.Добавить(Метаданные.Роли.Администратор);
		ИначеЕсли Объект.Роль = Перечисления.Роли.Менеджер тогда
			НовыйПользователь.Роли.Добавить(Метаданные.Роли.Менеджер);
		ИначеЕсли Объект.Роль = Перечисления.Роли.Мастер тогда
			НовыйПользователь.Роли.Добавить(Метаданные.Роли.Мастер);
		КонецЕсли;
		НовыйПользователь.Записать();  
	КонецЕсли;
КонецПроцедуры